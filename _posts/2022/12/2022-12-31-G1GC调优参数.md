---
layout: post
title: G1 GC的参数
tagline: by 揽月中人
categories: gc
tags:
- 揽月中人
---

哈喽，大家好，我是指北君。  

GC的内容很多，也不可能一时间全部都掌握，今天就要看看G1的一些知识，还有调优时可调整的参数。

<!--more-->

### 前言

对于Java程序员来说，GC总是要不断学习的，之前也写过一些相关的内容，感兴趣的老铁们可以看看哈。

[什么？ ZGC在Java 17中没有更新了！yyds](https://mp.weixin.qq.com/s?__biz=Mzg4MjYyOTgwNw==&mid=2247485602&idx=1&sn=4646ad1f7537867471cd267b1d20e321&chksm=cf528562f8250c743bbf9f5aeed26327f8c727cc14ca3d71062b3a6e87c19ec635a782df521c&token=475580734&lang=zh_CN#rd)

[GC垃圾收集器&JVM调优汇总](https://mp.weixin.qq.com/s?__biz=Mzg4MjYyOTgwNw==&mid=2247485931&idx=1&sn=bf03854abdfe21946bb380104ffdeb0e&chksm=cf52842bf8250d3d9f3201605a21d9b67767d05aa2f60197756ac30d060897237b707c6c8bbc&token=475580734&lang=zh_CN#rd)

[ParallelGC优化参数](https://mp.weixin.qq.com/s?__biz=Mzg4MjYyOTgwNw==&mid=2247493426&idx=1&sn=63772b2decce0b8a492d11812503e560&chksm=cf516af2f826e3e4a48f864756daf727c806ebb701664f1ea27f535963fa7f7f1ccceb85f332&token=117899278&lang=zh_CN#rd)

### 1.G1简介

G1的全称为 Garbage First Garbage Collector, 是一款内置在HotSpot JVM中的服务端垃圾收集器。

G1是作为CMS的替代产品出现的，其目标是在满足最短时间停顿的同时达到一个高吞吐量，适用于多核处理器，大内存容量的系统。

其特点如下：

- 短停顿时间且可控。 对内存进行分区，可以应用在大内存系统中，其使用了基于内存的新生代收集和混合收集。
- 高吞吐量。 设计了新的并发标记线程，并发处理分区之间的引用关系，加快垃圾回收速度。

#### 1.1分区

G1垃圾回收器将堆内存划分成固定大小的Region,下图为G1内存的分配示意图，其中灰色格子代表一个region。

![image-20221114005411137](E:\javaNorth\javanorth\assets\images\2022\lyj\G101.png)

 

其中G1的分区可以分为4类：

1. 自由分区（Free Heap Region， FHR）
2. 新生代分区（Young Heap Region ， YHR） 新生代也分为Eden 和Survivor区
3. 大对象分区（Humongous Heap Region，HHR） 大对象区可分为 大对象头分区和大对象连续分区，大对象一般占Region的一半以上。
4. 老生代分区（Old Heap Region，OHR）

![img](E:\javaNorth\javanorth\assets\images\2022\lyj\G102.png)

Region可以在1MB~32MB,且为2的N次幂，设定分区大小有以下方法：

- 可以通过-XX:G1HeapRegionSize=<>来指定大小，默认为0.
- 默认情况下是将整个堆分为2048个Region。





超过 50% 的 Java 堆被实时数据占用。

对象分配率或晋升率差异很大。

应用程序遇到意外的长时间垃圾回收或压缩暂停（超过 0.5 到 1 秒）

##### 1.1.1 新生代大小 

 新生代大小的设置如下： 

- 如果设置了最大值 （MaxNewSize） 和最小值（NewSize）， Xmn 等价于MaxNewSize
- 如果设置了最大值和最小值，又设置了NewRatio 则忽略NewRatio
- 如果没有设置新生代最大值和最小值，但是设置了NewRatio 则新生代的最大值最小值是相同的，都是整个堆空间的 （NewRatio+1）
- 如果没有设置新生代最大值和最小值，或者只设置了最大值或者最小值中的一个，那么G1将根据参数G1MaxNewSizePrecent（默认值60） 和 G1NewSizePercent （默认值5）占整个堆空间的比例计算最大值和最小值。



关于堆大小大小的参数优化：

- G1HeapRegionSize 可以指定堆的大小，可指定也可以有内存管理启发推断分区大小。

- xms/xmx 指定堆空间的最小值/最大值， 一定要设置正确的值，否则会影响分区大小推断。
- G1不要设置MaxNewSize，NewSize，Xmn, NewRatio ， G1对内存的管理不是连续的，所以即使重新分配一个堆分区的代价不大； G1的目标满足垃圾收集停顿，这需要G1根据停顿时间动态调整收集的分区，如果设置了固定的分区数，G1不能调整新生代的大小，则不容易满足停顿时间的需求。
- GCTimeRatio指的是GC与应用程序之间的时间占比，默认值是9，表示GC与程序的时间占比为90%，增大该值将减少GC占用时间，增大该值则动态扩展内存会更容易发生。
- 



#### 3.



#### 




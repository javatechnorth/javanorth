---
layout: post
title: 扫码登陆是如何实现的！-20230815
tagline: by 无花
categories: 
tags:
- 无花
---

哈喽，大家好，我是了不起。

我们日常使用扫码登陆的操作已经非常常见了，但是有没有仔细想过背后是怎么实现的呢，如果让你去实现一个扫码登陆的场景，你要去怎么做。

今天我们看看扫码登陆是如何实现的。

<!--more-->

###  扫码登陆的基本原理
扫码登陆有多种实现方式，但是基本原理都差不多。

原理可以简单概括如下：

1. 生成二维码：应用程序或网站生成一个包含登录信息的二维码，并将其展示在登录页面上。

2. 扫描二维码：用户使用相应的客户端（如微信、支付宝等）打开扫描功能，并扫描登录页面上的二维码。

3. 身份验证：客户端将扫描到的二维码信息发送到相应的身份验证服务器。服务器根据二维码信息中的标识符，识别出用户和应用程序的对应关系。

4. 用户确认：验证服务器向客户端发送一个授权请求，要求用户确认登录操作。用户在客户端上确认后，客户端将确认信息发送回验证服务器。

5. 完成登录：验证服务器验证用户的确认信息，并向应用程序或网站返回一个登录凭证。应用程序或网站使用该凭证进行用户登录，完成登录过程。

需要注意的是，具体的扫码登录原理可能会因不同的应用程序、网站和身份验证系统而有所差异。上述步骤仅提供了一种常见的扫码登录实现方式的概述。实际的实现可能涉及更多的细节和安全措施，以确保登录过程的安全性和用户体验。



下面给出一个简单的扫码登陆示意图：

![image-20230815212016284](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-010101)



概括其步骤如下： 

1. PC端打开登陆界面，获取登陆的二维码，这里面包含qrtoken等信息。此时页面会一直轮询后端，查询此qrtoken是否有人扫码。
2. 使用已有登录信息的手机APP扫面二维码，向后台发送登陆请求。此时页面轮询查询到qrtoken状态改变，就知道了有人扫码，页面就变成了待确认状态。（此时也可能会更换新的token来处理等待登陆的状态）
3. 手机APP扫码之后也会返回确认登陆的信息，此时后台会等待手机APP确认登录信息。网页也会一直轮询登陆状态。
4. 手机APP点击确认登陆后，发请求到后台表示登陆成功，更新前面的token登陆状态。 待页面轮询请求之后就能获得已经登陆的状态，而且会返回全新的token，后面的请求都会携带这个token来作为身份信息验证。



下面我们带着这个思路去看一下微信公众号的登陆流程。

直接看公众号生成的二维码： 下面的二维码信息内容如下：

http://mp.weixin.qq.com/mp/scanlogin?action=index&qrticket=4d00e589a1510dbe4866e9c01238fa09&scanscene=0#wechat_redirect

1. 其中有一个qrticket，这是一个后台生成的ticket（qrticket=4d00e589a1510dbe4866e9c01238fa09），页面会一直轮询，后台是否有人进行扫码。  而且这个二维码对应的token隔一段时间也会刷新，而且前端的cookie里面还有一大堆token。

![image-20230815210029789](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-0101)



2. 当手机扫码扫码登陆，那么后台就会立马更新ticket相关数据的状态。变成待确认状态



![image-20230815001555653](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-01)



扫码成功：

![image-20230815001811439](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-02.jpg)



这里一直使用了相同的uuid 

![image-20230815002515757](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-03.jpg)



拿到了token：（token=727475452）

![image-20230815002704047](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-04.jpg)



后面的页面会一直携带这个token，

![image-20230815002840637](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-05.jpg)



后面的请求一直会携带这个token，直到token过期。

![image-20230815003251103](D:\JavaNorth\javanorth\assets\images\2023\Flowerless\2308scan-06.jpg)



### 总结

关于扫码登陆，今天就看到这里。扫码登陆还有很多方式，大家可以再评论区补充一下，如果有必要，后面再分析一下其他的扫码登陆方式。
---
layout: post
title: 数据库优化
tagline: by 无花
categories: sql
tags:
- 无花
---

哈喽，大家好，我是了不起。  

面试的时候总有人会问数据库优化，有没有想过为什么面试官会这么注重数据库，我为大家总结了几点原因。

最近有兄弟想要看看数据库如何优化，那么我总结整理了数据库优化的一些方案。

1. 性能需求：随着数据量的增长和应用程序的复杂度增加，数据库的性能可能会成为瓶颈。优化数据库可以提高查询速度、数据插入和更新的效率，从而提升整个应用程序的性能。
2. 资源利用：数据库可能占用大量的系统资源，如内存、CPU 和磁盘 I/O。通过优化数据库，可以减少资源的消耗，提高系统的整体效率。
3. 数据量增长：随着时间的推移，数据库中的数据量可能会迅速增长。优化可以帮助处理大规模数据集，确保数据库在处理大量数据时仍能保持良好的性能。
4. 应用程序扩展：当应用程序需要支持更多用户、处理更多并发请求或扩展到新的功能时，数据库可能需要进行优化以满足新的需求。
5. 竞争压力：在竞争激烈的市场中，优化数据库可以提供更好的用户体验，提高应用程序的竞争力。
6. 成本考虑：优化数据库可以降低硬件成本和运营成本。通过提高性能和效率，可以减少所需的服务器资源和能源消耗。
7. 维护和管理：优化数据库有助于减少维护工作和故障排除的时间。良好的优化可以提高数据库的稳定性和可靠性。

<!--more-->

### 前言

数据库性能优化主要包含有一下几个方面，数据库服务端（包括数据库选择，内存设置，缓冲池调整，并发连接数等等）， 连接网络，数据库客户端（数据库表的设计，SQL语句优化，索引优化，)，等。作为开发人员，我们直接使用到比较多的地方就是数据库客户端的的优化项。

以下为大家整理一些数据库使用时注意的点：

### 数据库表的设计

1. 明确数据需求：在设计表之前，需要明确所需存储的数据以及数据之间的关系。
2. 选择合适的字段类型：根据数据的特性选择合适的字段类型，例如整数、字符串、日期等。尽量选择能够准确表示数据的最小字段类型，以节省存储空间。
3. 定义主键：每个表都应该有一个唯一的主键，用于标识每一行数据。主键可以是一个或多个字段的组合。
4. 保持数据完整性：通过使用约束（如主键约束、唯一约束、非空约束等）来确保数据的完整性和准确性。
5. 考虑性能：在设计表时需要考虑数据量、查询频率等因素，合理选择索引、分表等技术来提高数据库的性能。
6. 字段命名规范：使用有意义的字段名，遵循命名规范，便于理解和维护。
7. 避免冗余数据：尽量避免在多个表中存储相同或相似的数据，以减少数据的冗余和一致性问题。
8. 考虑扩展性：设计表时应考虑未来可能的需求变更，预留一些扩展性较强的字段或采用可扩展性的设计模式。
9. 范式设计：根据具体需求，遵循适当的范式（如第一范式、第二范式等）来设计表结构，以确保数据的一致性和正确性。
10. 文档化设计：记录表的结构、字段说明、约束等信息，以便于开发人员理解和维护。



### SQL语句优化

1. 对查询进行优化，要尽量避免全表扫描，首先考虑在where，order by ，group by 的字段上加索引。

2. 尽量避免在where子句中对字段进行null值判断，否则将导致引擎放弃使用索引，进行全表扫面。

3. 尽量避免在where子句中使用!= 或者<> 操作符，否则将引擎放弃使用索引而进行全表扫面。

4. 尽量避免在wher子句中使用or来连接条件，吐过一个字段有索引，一个字段没有索引，将导致引擎放弃使用索引，导致全表扫描。

5. in和 not in 要慎用，容易导致全表扫描，可以使用exist 代替in

6. where子句中模糊查询使用前置匹配会导致全表扫面。

7. 如果在where子句中使用参数也会导致全表扫面。

8. 尽量避免在where子句中对字段进行函数操作。会导致全表扫描。

9. 尽量避免在where子句中 “=” 的左边进行函数等表达式运算，否则会导致全表扫面/

10. 使用索引字段为条件时，若为复合索引，那么必须使用到该索引中的第一个字段作为条件，这样才能保证索引被正确使用。

11. 避免没有意义的查询。

12. update语句尽量只更新必须的字段，减少性能消耗。

13. 对于多张大数据表，join的时候，需要先分页再join，否则逻辑读会比较高，性能差。

14. 索引并不是越多越好，一个表的索引最好不要超过6个。

15. 尽量使用数字型字段，只含有数字的字段尽量不要设计为字符串，这会降低查询和连接的性能。

16. 尽可能使用varchar/nvachar 代替 char/nchar 因为变长字段存储空间小，可以节省存储空间。较小的字段查询效率也更高一点。

17. 任何地方都不要用select * from t。

18. 避免频繁删除和创建临时表，减少系统表资源消耗。

19. 新建临时表的时候，如果一次性插入数据量很大的话，可以使用select into 代替create table。

20. 如果用到了临时表，在存储过程的最后务必将所有的临时表显式删除，先truncate table 然后再drop table 。可以避免系统表的长时间锁定。

21. 尽量避免使用游标。

22. 尽量避免大事务操作，提高系统并发能力。

23. 避免向客户端返回大数据量，若数据量过大，应该考虑相应需求是否合理。

24. 拆分大的DELETE 和 insert 语句，应该批量执行这些SQL语句。

    

### 索引优化

1. 选择合适的列：只在需要高效检索的列上创建索引。避免在大字段或低选择性的列上创建索引，因为这可能导致索引维护开销变大。
2. 控制索引数量：过多的索引会增加数据插入、更新和删除的开销，同时也会占用更多的存储空间。因此，只创建必要的索引。
3. 考虑索引顺序：在多列索引中，列的顺序会影响查询性能。将选择性高、经常用于查询条件的列放在索引的前面。
4. 避免重复索引：避免在同一列或组合上创建多个索引，因为数据库只会使用其中一个。
5. 维护索引的有效性：定期对索引进行维护，例如重建或重新组织索引，以确保其性能。
6. 使用覆盖索引：如果查询只需要索引中的列，可以使用覆盖索引，避免回表操作。
7. 利用索引的排序能力：如果查询需要按照特定顺序排序结果，可以利用索引的排序能力，避免额外的排序操作。
8. 考虑聚簇索引：对于经常进行范围查询的表，可以考虑使用聚簇索引，将相关数据存储在一起，提高查询性能。
9. 监控和分析索引性能：定期监控和分析索引的使用情况，根据实际情况进行调整或删除不必要的索引。
10. 测试和实验：在实施索引优化之前，进行测试和实验，评估不同索引策略对查询性能的影响。





